2022.03.28 TIL

### 📌 Live Session
- 활동학습: 메모리의 구조 with 우롱차, papri
    - 컴퓨터의 주기억장치는 어떤 영역을 가지고 있을까?

    - ARC는 무엇인가?

    - ARC 이전의 메모리 관리는 어땠을까?

    - ARC를 이해해야 하는 이유는 무엇일까?

    - 언제 구조체를 선택하고 언제 클래스를 선택해야 할까?


### 📌 ARC
- 앱의 메모리 사용을 관리하는 방식
- 대부분의 경우에는 메모리 관리를 알아서 하기 때문에 신경쓰지 않아도 됨
- 참조 횟수는 클래스 타입의 인스턴스에만 적용되고 값타입인 구조체와 열거형에는 적용되지 않는다.

**How ARC Works**
- 클래스의 인스턴스가 생성될 때마다 ARC가 메모리를 할당
- 해당 인스턴스가 필요없어지면 다른 용도로 메모리를 재사용하기 위해 할당되었던 공간을 해제한다.

ARC가 인스턴스에 할당했던 메모리를 해제하면, 더 이상 인스턴스의 프로퍼티나 메서드에 접근할 수 없다.
만약 메모리 해제된 인스턴스에 접근하려고 하면, 크래쉬가 발생
따라서 인스턴스가 해제되어도 되는지 확인하기 위해 이 클래스 인스턴스의 참조 횟수를 추적하고 있다가 더 이상 어느 곳에서도 참조되지 않을 때 해당 인스턴스를 메모리에서 해제한다.

프로퍼티, 상수, 변수에서 참조가 일어날  때마다 **강한 참조**가 발생 



### **Strong Reference Cycles Between Class Instances**

더 이상 필요하지 않으면 메모리를 해제한다고 했었는데...
소스 코드를 이용하면 더 이상 참조가 없어도 메모리에서 해제되지 않도록 만들 수 있다.

- 두 클래스 인스턴스가 서로에 대한 강한 참조를 유지하여 상대방이 살아있게 만듦. 
- 클래스 인스턴스간 서로 강한 참조가 발생하는 상황 => 강한 참조 순환
- 인스턴스가 해제되어도 각각 상호 참조를 하고 있어 참조 횟수가 둘다 1이기 때문에 두 인스턴스는 해제되지 않음. 
- ❗️메모리 누수 발생.❗️

### **참조 순환을 해결하기 위한 방법**
- 두 방법 모두 reference count를 증가시키지 않음
- **weak**
    - 참조가 해제되면 참조 대상을 nil로 변경
    - 그렇기 때문에 일반적으로 Optional, 변수로 선언
    - 참조 대상이 없을 수도 있음을 전제로 둔다.

- **unowned**
    - 참조 대상이 참조 주체보다 (무조건) 생명 주기가 같거나 길다고 가정함
    - 즉 내(참조 주체)가 살아있는 동안 참조 대상이 항상 있을 거라고 생각하는 것과 같다.
    - 참조가 해제되면? 그것까지는 고려 하지 않는다!!
    - 일반적으로 Optional로 사용할 수 없음
    - nil이 될 수 없다기보다는, 대상이 한번 초기화되면 그 이후에는 nil이 될 수 없는 경우에 옵셔널로 사용 가능

